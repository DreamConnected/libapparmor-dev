# This profile allows almost everything and only exists to allow
# bwrap to work on a system with user namespace restrictions
# being enforced.
# bwrap is allowed access to user namespaces and capabilities
# within the user namespace, but its children do not have
# capabilities, blocking bwrap from being able to be used to
# arbitrarily by-pass the user namespace restrictions.
#
# Note: the bwrap child is stacked against the bwrap profile due to
# bwraps used of no-new-privs

profile bwrap /usr/bin/bwrap flags=(attach_disconnected) {
    allow capability,
    allow file rwlkm /{**,},
    allow network,
    allow unix,
    allow ptrace,
    allow signal,
    allow mqueue,
    allow io_uring,
    allow userns,
    allow mount,
    allow umount,
    allow pivot_root,
    allow dbus,
    allow px /** -> bwrap//&unpriv_bwrap,

}

profile unpriv_bwrap flags=(attach_disconnected) {
    allow all,
    audit deny capability,
}

