# Note: This profile does not specify an attachment path because it is
# intended to be used only via "Px -> lsb_release" exec transitions from
# other profiles. We want to confine the lsb_release(1) utility when it
# is invoked from other confined applications, but not when it is used
# in regular (unconfined) shell scripts or run directly by the user.

abi <abi/4.0>,

include <tunables/global>

# Do not attach to @{bin}/lsb_release by default
profile lsb_release {
  include <abstractions/base>
  include <abstractions/python>

  owner @{PROC}/@{pid}/fd/ r,

  /dev/tty rw,

  @{bin}/lsb_release r,
  @{bin}/python3.{1,}[0-9] mr,

  /etc/debian_version r,
  /etc/default/apport r,
  /etc/dpkg/origins/** r,
  /etc/lsb-release r,
  /etc/lsb-release.d/ r,

  @{bin}/bash ixr,
  @{bin}/dash ixr,
  @{bin}/basename ixr,
  @{bin}/dpkg-query ixr,
  @{bin}/cat ixr,
  @{bin}/cut ixr,
  @{bin}/getopt ixr,
  @{bin}/sed ixr,
  @{bin}/tr ixr,

  # TODO - many more permissions needed for this to work
  deny @{bin}/apt-cache x,

  @{bin} r,
  /usr/include/python*/pyconfig.h r,
  /usr/share/distro-info/** r,
  /usr/share/dpkg/** r,
  /usr/share/terminfo/** r,
  /var/lib/dpkg/** r,

  # file_inherit
  deny /tmp/gtalkplugin.log w,

  # Site-specific additions and overrides. See local/README for details.
  include if exists <local/lsb_release>
}
