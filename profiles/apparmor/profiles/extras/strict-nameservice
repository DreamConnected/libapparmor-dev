#------------------------------------------------------------------
#    Copyright (C) 2024 Nishit Majithia (0xnishit)
#    Copyright (C) 2024 Canonical Ltd.
#
#    This program is free software; you can redistribute it and/or
#    modify it under the terms of version 2 of the GNU General Public
#    License published by the Free Software Foundation.
#------------------------------------------------------------------
# vim: ft=apparmor

    # Read-only access to system group configuration
    file r @{etc_ro}/group,

    # Read-only access to host configuration files
    file r @{etc_ro}/host.conf,
    file r @{etc_ro}/hosts,
    file r @{etc_ro}/nsswitch.conf,
    file r @{etc_ro}/gai.conf,
    file r @{etc_ro}/passwd,
    file r @{etc_ro}/protocols,

    # Read-only access to network configuration
    file r @{etc_ro}/netconfig,

    # Extrausers group and password access
    file r /var/lib/extrausers/group,
    file r /var/lib/extrausers/passwd,

    # Read-only access to `nss` pipes
    file r /var/lib/sss/pipes/nss,

    # Read-only access to resolv.conf
    file r @{etc_ro}/resolv.conf,

    # Read-only access to various resolver configurations
    file r @{etc_ro}/resolvconf/run/resolv.conf,
    file r @{run}/{resolvconf,NetworkManager,systemd/resolve,connman,netconfig}/resolv.conf,
    file r @{run}/systemd/resolve/stub-resolv.conf,

    # Read-only access to Samba lmhosts and services configuration
    file r @{etc_ro}/samba/lmhosts,
    file r @{etc_ro}/services,

    # Read-only access to nscd sockets
    file r @{run}/.nscd_socket,
    file r @{run}/nscd/socket,

    # Read-only access to nscd databases
    file r /{var/db,var/cache,var/lib,var/run,run}/nscd/{passwd,group,services,hosts},

    file ixmr @{run}/nscd/db*,

    # Read access to libnss shared libraries
    file mr /{usr/,}lib{,32,64}/libnss_*.so*,
    file mr /{usr/,}lib/@{multiarch}/libnss_*.so*,
    file r @{etc_ro}/default/nss,
